package Libraries.Interface.Layouts

use Libraries.Interface.Item2D
use Libraries.Containers.Array
use Libraries.Language.Support.CompareResult
use Libraries.Interface.Controls.Control

class ManualLayout is Layout

    action Layout(Control container, Array<Item2D> items, number containerWidth, number containerHeight)

        integer counter = 0

        repeat while counter < items:GetSize()
            Item2D item = items:Get(counter)
            if item is Control
                Control control = cast(Control, item)
                control:ResetLayoutFlag()
                LayoutProperties properties = control:GetLayoutProperties(containerWidth, containerHeight)

                if properties not= undefined
                    if properties:NeedsRendering()
                        control:LoadGraphics(properties)
                    end

                    number width = control:GetWidth()
                    number height = control:GetHeight()

                    if properties:IsSettingWidth()
                        width = containerWidth * properties:GetPercentageWidth() + properties:GetPixelWidth() 
                    end

                    if properties:IsSettingHeight()
                        height = containerHeight * properties:GetPercentageHeight() + properties:GetPixelHeight()
                    end

                    if width < properties:GetMinimumWidth()
                        width = properties:GetMinimumWidth()
                    elseif width > properties:GetMaximumWidth()
                        width = properties:GetMaximumWidth()
                    end

                    if height < properties:GetMinimumHeight()
                        height = properties:GetMinimumHeight()
                    elseif height > properties:GetMaximumHeight()
                        height = properties:GetMaximumHeight()
                    end

                    if properties:IsPositioningInX()
                        if properties:IsPositioningInY()
                            control:SetPosition(containerWidth * properties:GetPercentageX() + properties:GetPixelX() - width * properties:GetPercentageOriginX(),
                                containerHeight * properties:GetPercentageY() + properties:GetPixelY() - height * properties:GetPercentageOriginY())
                        else
                            control:SetX(containerWidth * properties:GetPercentageX() + properties:GetPixelX() - width * properties:GetPercentageOriginX())
                        end
                    elseif properties:IsPositioningInY()
                        control:SetY(containerHeight * properties:GetPercentageY() + properties:GetPixelY() - height * properties:GetPercentageOriginY())
                    end

                    if properties:IsSettingWidth()
                        if properties:IsSettingHeight()
                            control:SetSize(width, height)
                        else
                            control:SetWidth(width)
                        end
                    elseif properties:IsSettingHeight()
                        control:SetHeight(height)
                    end
                end
            end

            counter = counter + 1
        end

//        Layout(item)
//
//        counter = 0
//        Array<Item2D> children = item:GetChildren()
//        repeat while counter < children:GetSize()
//            children:Get(counter):Resize()
//            counter = counter + 1
//        end
    end

end